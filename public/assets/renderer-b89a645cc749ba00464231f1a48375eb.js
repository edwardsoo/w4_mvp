!function(){Renderer=function(e){var a=$(e),e=a.get(0),o=e.getContext("2d"),t=arbor.Graphics(e),n=null,d=!1,l=null,i=null,r=null,s=function(e,a){if(0!==e.data.alpha){var n=e.data.imageob,d=parseInt(e.data.radius),l=e.data.label||"",i=o.measureText(""+l).width+20;if(d>i?i=d:e.data.radius=i,(""+l).match(/^[ \t]*$/)?l=null:(a.x=Math.floor(a.x),a.y=Math.floor(a.y)),o.fillStyle=e.data.color?e.data.color:"rgba(0,0,0,.2)","none"==e.data.color&&(o.fillStyle="white"),"dot"==e.data.shape){if(e.data.followerExpanded&&e.data.followingExpanded?t.oval(a.x-i/2,a.y-i/2,i,i,{fill:"red",alpha:1}):t.oval(a.x-i/2,a.y-i/2,i,i,{fill:"green",alpha:1}),t.oval(a.x-i/2+2,a.y-i/2+2,i-4,i-4,{fill:o.fillStyle,alpha:e.data.alpha}),f[e.name]=[a.x-i/2,a.y-i/2,i,i],n){var r=Math.max(0,a.x-13),s=Math.max(0,a.y-25);o.drawImage(n,r,s,26,26)}}else t.rect(a.x-i/2,a.y-10,i,20,4,{fill:o.fillStyle,alpha:e.data.alpha}),f[e.name]=[a.x-i/2,a.y-11,i,22];if(l){o.font="12px Helvetica",o.textAlign="center",o.lineWidth=1,o.fillStyle="white",o.strokeStyle="black";var u="dot"==e.data.shape?12:4;o.fillText(l||"",a.x,a.y+u)}(e.data.followingLoading||e.data.followerLoading)&&(t.oval(a.x-i/2,a.y-i/2,i,i,{fill:"white",alpha:.7}),o.font="16px Helvetica",o.fillStyle="black",o.fillText("loading...",a.x,a.y+3))}},u=function(e,a,t){if(0!=e.source.data.alpha*e.target.data.alpha){var n=0,d=colour.black;if((!d||(""+d).match(/^[ \t]*$/))&&(d=null),"dot"==e.source.data.shape)var l=p(t,a,e.source.data.radius);else var l=y(t,a,f[e.source.name]);var i=p(a,t,e.target.data.radius);o.save(),o.beginPath(),isNaN(n)||(o.lineWidth=n),d&&(o.strokeStyle=d),o.fillStyle=null,o.moveTo(l.x,l.y),o.lineTo(i.x,i.y),o.stroke(),o.restore(),o.save();var r=isNaN(n)?o.lineWidth:parseFloat(n),s=6+r,u=2+r;o.fillStyle=d?d:o.strokeStyle,o.translate(i.x,i.y),o.rotate(Math.atan2(i.y-l.y,i.x-l.x)),o.clearRect(-s/2,-r/2,s/2,r),o.beginPath(),o.moveTo(-s,u),o.lineTo(0,0),o.lineTo(-s,-u),o.lineTo(.8*-s,-0),o.closePath(),o.fill(),o.restore()}},f={},g={init:function(a){n=a,n.screenSize(e.width,e.height),n.screenPadding(25,50),g.initMouseHandling(),n.eachNode(function(e){e.data.image&&(e.data.imageob=new Image,e.data.imageob.src=e.data.image)}),n.eachNode(s),$(window).resize(g.resize),g.resize()},resize:function(){e.width=$(window).width(),e.height=.8*$(window).height(),sys.screen({size:{width:e.width,height:e.height}}),g.redraw()},redraw:function(){t.clear(),n.eachEdge(u),n.eachNode(s)},switchMode:function(e){"hidden"==e.mode?a.stop(!0).fadeTo(e.dt,0,function(){sys&&sys.stop(),$(this).hide()}):"visible"==e.mode&&(a.stop(!0).css("opacity",0).show().fadeTo(e.dt,1,function(){g.resize()}),sys&&sys.start())},switchSection:function(e){var a=sys.getEdgesFrom(e)[0].source,o=$.map(sys.getEdgesFrom(e),function(e){return e.target});sys.eachNode(function(e){if("dot"!=e.data.shape){var t=$.inArray(e,o)>=0,n=t?1:0,d=t?.5:.5;sys.tweenNode(e,d,{alpha:n}),1==n&&(e.p.x=a.p.x+3*Math.random()-.025,e.p.y=a.p.y+3*Math.random()-.025,e.tempMass=.001)}})},initMouseHandling:function(){l=null,i=null;var o=null,t={moved:function(o){var t=$(e).offset();return r=arbor.Point(o.pageX-t.left,o.pageY-t.top),i=sys.nearest(r),i.node?("dot"!=i.node.data.shape&&(l=i.distance<50?i:null,l?a.addClass("linkable"):(a.removeClass("linkable"),window.status="")),!1):!1},clicked:function(a){var n=$(e).offset();if(r=arbor.Point(a.pageX-n.left,a.pageY-n.top),i=o=sys.nearest(r),i&&i.node&&jQuery.isNumeric(i.node.name)){var l=i.node;d||(sys.getNode("click")&&sys.pruneNode("click"),sys.getNode("user")&&sys.pruneNode("user"),sys.getNode("border")&&sys.pruneNode("border"),d=!0),l.data.followingExpanded||l.data.followingLoading||(l.data.followingLoading=!0,null==l.data.followingPage&&(l.data.followingPage=0),$.ajax({url:"graph/friends",data:{id:l.name,page:l.data.followingPage}}).success(function(e){$.each(e,function(e,a){var o=sys.getNode(a.id);o||(o=sys.addNode(a.id,{label:"@"+a.screen_name,color:colour.orange,shape:"dot",radius:70,alpha:1,image:a.profile_image_url_https}),o.data.image&&(o.data.imageob=new Image,o.data.imageob.src=o.data.image)),sys.addEdge(l,o)}),e.length<10?l.data.followingExpanded=!0:l.data.followingPage++}).error(function(e){$msg=$.parseHTML("<div style=''>"+e.responseText+"</div>"),$("#error").prepend($msg),$($msg).delay(5e3).fadeOut(800,function(){$(this).remove()})}).complete(function(){l.data.followingLoading=!1})),l.data.followerExpanded||l.data.followerLoading||(l.data.followerLoading=!0,null==l.data.followerPage&&(l.data.followerPage=0),$.ajax({url:"graph/followers",data:{id:l.name,page:l.data.followerPage}}).success(function(e){$.each(e,function(e,a){var o=sys.getNode(a.id);o||(o=sys.addNode(a.id,{label:"@"+a.screen_name,color:colour.orange,shape:"dot",radius:70,alpha:1,image:a.profile_image_url_https}),o.data.image&&(o.data.imageob=new Image,o.data.imageob.src=o.data.image)),sys.addEdge(o,l)}),e.length<10?l.data.followerExpanded=!0:l.data.followerPage++}).error(function(e){$msg=$.parseHTML("<div style=''>"+e.responseText+"</div>"),$("#error").prepend($msg),$($msg).delay(5e3).fadeOut(800,function(){$(this).remove()})}).complete(function(){l.data.followerLoading=!1}))}return o&&null!==o.node&&(o.node.fixed=!0),$(e).unbind("mousemove",t.moved),$(e).bind("mousemove",t.dragged),$(window).bind("mouseup",t.dropped),!1},dragged:function(a){i&&i.node._id;var t=$(e).offset(),n=arbor.Point(a.pageX-t.left,a.pageY-t.top);if(i){if(null!==o&&null!==o.node){var d=sys.fromScreen(n);o.node.p=d}return!1}},dropped:function(){return null!==o&&void 0!==o.node?(null!==o.node&&(o.node.fixed=!1),o.node.tempMass=1e3,o=null,$(e).unbind("mousemove",t.dragged),$(window).unbind("mouseup",t.dropped),$(e).bind("mousemove",t.moved),r=null,!1):void 0}};$(e).mousedown(t.clicked),$(e).mousemove(t.moved)}},c=function(e,a,o,t){var n=(t.y-o.y)*(a.x-e.x)-(t.x-o.x)*(a.y-e.y);if(0===n)return!1;var d=((t.x-o.x)*(e.y-o.y)-(t.y-o.y)*(e.x-o.x))/n,l=((a.x-e.x)*(e.y-o.y)-(a.y-e.y)*(e.x-o.x))/n;return 0>d||d>1||0>l||l>1?!1:arbor.Point(e.x+d*(a.x-e.x),e.y+d*(a.y-e.y))},y=function(e,a,o){var t={x:o[0],y:o[1]},n=o[2],d=o[3],l={x:t.x,y:t.y},i={x:t.x+n,y:t.y},r={x:t.x,y:t.y+d},s={x:t.x+n,y:t.y+d};return c(e,a,l,i)||c(e,a,i,s)||c(e,a,s,r)||c(e,a,r,l)||!1},p=function(e,a,o){var t=a.x-e.x,n=a.y-e.y,d=Math.sqrt(Math.pow(t,2)+Math.pow(n,2)),l=o*t/d,i=o*n/d;return arbor.Point(a.x-l/2,a.y-i/2)};return g}}();